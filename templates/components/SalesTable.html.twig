<div {{ attributes.defaults({class: 'dashboard-container'}) }}>
    <div class="dashboard-header">
        <header class="dashboard-header">
            <h1>üìä Dashboard des ventes</h1>
        </header>
    </div>
    <div class="stats-bar">
        <div class="stat-card">
            <div class="stat-value">{{ this.stats.total }}</div>
            <div class="stat-label">Ventes totales</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ this.stats.totalAmount|number_format(0, ',', ' ') }} ‚Ç¨</div>
            <div class="stat-label">Chiffre d'affaires</div>
        </div>
        <div class="stat-card">
            <div class="stat-value">{{ this.stats.averageAmount|number_format(0, ',', ' ') }} ‚Ç¨</div>
            <div class="stat-label">Panier moyen</div>
        </div>
    </div>

    <twig:SalesChart :query="query" :period="period" :status="status" />

    <div class="filters-bar">
        <div class="filter-group">
            <label>üîç Recherche</label>
            <input
                type="text"
                data-model="query"
                placeholder="Rechercher un client..."
                class="filter-input"
            >
        </div>

        <div class="filter-group">
            <label>üìä Statut</label>
            <select data-model="status" class="filter-select">
                <option value="">Tous les statuts</option>
                <option value="paid">‚úÖ Pay√©</option>
                <option value="pending">‚è≥ En attente</option>
                <option value="cancelled">‚ùå Annul√©</option>
            </select>
        </div>

        <div class="filter-group">
            <label>üìÖ P√©riode</label>
            <select data-model="period" class="filter-select">
                <option value="all">Toute la p√©riode</option>
                <option value="today">Aujourd'hui</option>
                <option value="week">7 derniers jours</option>
                <option value="month">30 derniers jours</option>
                <option value="quarter">3 derniers mois</option>
            </select>
        </div>

        {% if this.hasActiveFilters %}
            <button
                data-action="live#action"
                data-live-action-param="resetFilters"
                class="btn-reset"
            >
                üîÑ R√©initialiser
            </button>
        {% endif %}
    </div>

    <div class="table-section">
        <div class="table-container">
            <table class="sales-table">
                <thead>
                <tr>
                    <th
                        data-action="click->live#action"
                        data-live-action-param="sort"
                        data-live-column-param="id"
                        class="sortable {{ this.isSortedBy('id') ? 'sorted' : '' }}"
                    >
                        ID {{ this.getSortIcon('id') }}
                    </th>

                    <th
                        data-action="click->live#action"
                        data-live-action-param="sort"
                        data-live-column-param="date"
                        class="sortable {{ this.isSortedBy('date') ? 'sorted' : '' }}"
                    >
                        Date {{ this.getSortIcon('date') }}
                    </th>

                    <th
                        data-action="click->live#action"
                        data-live-action-param="sort"
                        data-live-column-param="client"
                        class="sortable {{ this.isSortedBy('client') ? 'sorted' : '' }}"
                    >
                        Client {{ this.getSortIcon('client') }}
                    </th>

                    <th
                        data-action="click->live#action"
                        data-live-action-param="sort"
                        data-live-column-param="amount"
                        class="sortable {{ this.isSortedBy('amount') ? 'sorted' : '' }}"
                    >
                        Montant {{ this.getSortIcon('amount') }}
                    </th>

                    <th
                        data-action="click->live#action"
                        data-live-action-param="sort"
                        data-live-column-param="status"
                        class="sortable {{ this.isSortedBy('status') ? 'sorted' : '' }}"
                    >
                        Statut {{ this.getSortIcon('status') }}
                    </th>
                </tr>
                </thead>
                <tbody>
                {% for sale in this.paginatedSales %}
                    <tr>
                        <td>#{{ sale.id }}</td>
                        <td>{{ sale.date|date('d/m/Y') }}</td>
                        <td>{{ sale.client }}</td>
                        <td class="amount">{{ sale.amount|number_format(2, ',', ' ') }} ‚Ç¨</td>
                        <td>
                            {% if sale.status == 'paid' %}
                                <span class="badge badge-success">‚úÖ Pay√©</span>
                            {% elseif sale.status == 'pending' %}
                                <span class="badge badge-warning">‚è≥ En attente</span>
                            {% else %}
                                <span class="badge badge-danger">‚ùå Annul√©</span>
                            {% endif %}
                        </td>
                    </tr>
                {% else %}
                    <tr>
                        <td colspan="5" class="empty-state">
                            Aucune vente trouv√©e pour "{{ this.query }}"
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
        <div data-loading class="loading-overlay">
            <div class="spinner"></div>
        </div>
    </div>

    {% if this.totalPages > 1 %}
        <div class="pagination">
            <div class="pagination-info">
                Affichage {{ ((page - 1) * 15) + 1 }}
                √† {{ min(page * 15, this.totalCount) }}
                sur {{ this.totalCount }} ventes
            </div>

            <div class="pagination-controls">
                {% if page > 1 %}
                    <button
                        data-action="live#update"
                        data-model="page"
                        data-value="1"
                        class="btn-page"
                    >
                        ‚èÆÔ∏è Premi√®re
                    </button>
                    <button
                        data-action="live#update"
                        data-model="page"
                        data-value="{{ page - 1 }}"
                        class="btn-page"
                    >
                        ‚óÄÔ∏è Pr√©c√©dente
                    </button>
                {% endif %}

                <span class="current-page">
                    Page {{ page }} / {{ this.totalPages }}
                </span>

                {% if page < this.totalPages %}
                    <button
                        data-action="live#update"
                        data-model="page"
                        data-value="{{ page + 1 }}"
                        class="btn-page"
                    >
                        Suivante ‚ñ∂Ô∏è
                    </button>
                    <button
                        data-action="live#update"
                        data-model="page"
                        data-value="{{ this.totalPages }}"
                        class="btn-page"
                    >
                        Derni√®re ‚è≠Ô∏è
                    </button>
                {% endif %}
            </div>
        </div>
    {% endif %}
</div>
